<!doctype html>
<html lang="en">

<head>
    <title>Painel Administrativo</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>

    <!-- NAVBAR -->

    <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
        <a class="navbar-brand" href="/views">CGO</a>
        <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#collapsibleNavId"
            aria-controls="collapsibleNavId" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active">
                    <a class="nav-link" href="/views/orcamento">Orçamento </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/views/chart">Gráficos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/views/suporte">Suporte</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- NAVBAR -->

    <table class="table container">
        <thead>
            <tr>
                <th>ID</th>
                <th>ID_PLANTA</th>
                <th>ID_ORÇADOR</th>
                <th>CUSTO_MATERIAL</th>
                <th>CUSTO_MATERIAL</th>
                <th>EDITAR</th>
                <th>DELETAR</th>
                <td><a id="criar" href="" class="btn btn-default btn-rounded mb-4" data-toggle="modal"
                        data-target="#modalCriacao">Criar Usuario</a></td>
            </tr>
        </thead>
        <tbody id="tabela">
        </tbody>
        <tfoot>
            <tr>
                <td colspan="5">

                </td>
            </tr>
        </tfoot>
    </table>


    <!-- Modal Structure Editar-->
    <div id="modal-edicao" class="modal">
        <div class="modal-content">
            <div class="row">
                <form id="form-edicao" class="col s12">
                    <input type="hidden" id="ed-id_planta" name="id_planta" />
                    <div class="row container">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="ed-id_orcador" name="id_orcador" type="text"
                                class="validate">
                            <label for="id_orcador">ID_ORCADOR</label>
                        </div>
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="ed-custo_material" name="custo_material" type="text"
                                class="validate">
                            <label for="custo_material">CUSTO_MATERIAL</label>
                        </div>
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="ed-custo_operacional" name="custo_operacional"
                                type="text" class="validate">
                            <label for="custo_operacional">CUSTO_OPERACIONAL</label>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a onclick="editarUsuario()" href="#!" style="color: white"
                class="modal-close waves-effect waves-blue btn-flat blue">EDITAR</a>
        </div>
    </div>

    <!--Modal Criação Bootstrap-->
    <div id="modalCriacao" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Criar Usuario</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="form-criacao">
                    <div class="modal-body mx-3">
                        <div class="md-form mb-5">
                            <label data-error="wrong" data-success="right" for="id_planta"><i
                                    class="fa fa-user prefix grey-text"></i> - ID_PLANTA</label>
                            <input placeholder="Insira" type="text" id="cr-id_planta" name="id_planta"
                                class="form-control validate">
                        </div>
                        <div class="md-form mb-5">
                            <label data-error="wrong" data-success="right" for="id_orcador">ID_ORCADOR</label>
                            <input placeholder="Insira" type="text" id="cr-id_orcador" name="id_orcador"
                                class="form-control validate">
                        </div>
                        <div class="md-form mb-4">
                            <label data-error="wrong" data-success="right" for="custo_material">CUSTO_MATERIAL</label>
                            <input placeholder="Insira a Senha" type="text" id="cr-custo_material" name="custo_material"
                                class="form-control validate">
                        </div>
                        <div class="md-form mb-4">
                            <label data-error="wrong" data-success="right"
                                for="custo_operacional">CUSTO_OPERACIONAL</label>
                            <input placeholder="Insira o Curso" type="text" id="cr-custo_operacional"
                                name="custo_operacional" class="form-control validate">
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button id="confirmar" onclick="criarUsuario()"
                            class="btn btn-default btn-rounded">Confirmar</button>
                        <button id="cancelar" class="btn btn-default btn-rounded">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Structure Deletar-->
    <div id="modal-delecao" class="modal">
        <div class="modal-content">
            <h5>Confirmar Deleção do Usuário</h5>
        </div>
        <form id="form-delecao">
            <input type="hidden" name="id_planta" id="dl-id_planta" />
        </form>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect btn-flat">NÃO</a>
            <a onclick="deletarUsuario()" href="#!" style="color: white"
                class="modal-close waves-effect waves-red btn-flat red">CONFIRMA DELEÇÃO</a>
        </div>
    </div>

    <script>
        let modalCriacao = null;
        let modalEdicao = null;
        document.addEventListener('DOMContentLoaded', function () {
            var elems = document.querySelectorAll('.modal');
            var instances = M.Modal.init(elems, {});
            modalEdicao = instances[0];
            modalCriacao = instances[1];
            modalDelecao = instances[2];
        });
    </script>
    <script>
        let listaDeOrcamentos = [];
        let tabela = document.getElementById('tabela');

        function mostraModal(i) {
            modalEdicao.open();
            document.getElementById('ed-id_planta').value = listaDeOrcamentos[i].id_planta;
            document.getElementById('ed-id_orcador').value = listaDeOrcamentos[i].id_orcador;
            document.getElementById('ed-custo_material').value = listaDeOrcamentos[i].custo_material;
            document.getElementById('ed-custo_operacional').value = listaDeOrcamentos[i].custo_operacional;
        }

        function mostraModalDelecao(i) {
            modalDelecao.open();
            document.getElementById('dl-id_planta').value = listaDeOrcamentos[i].id_planta;
        }

        function atualiza() {
            fetch('/orcamentos')
                .then(res => res.json())
                .then(dados => {
                    listaDeOrcamentos = dados;
                    tabela.innerHTML = listaDeOrcamentos.map((orcamento, i) => `
       <tr>
               <td>${orcamento.id}</td>
               <td>${orcamento.id_planta}</td>
               <td>${orcamento.id_orcador}</td>
               <td>${orcamento.custo_material}</td>
               <td>${orcamento.custo_operacional}</td>
               <td><i onclick="mostraModal(${i})" class="material-icons">edit</i></td>
               <td><i onclick="mostraModalDelecao(${i})" class="material-icons" style="color:red">close</i></td>
           </tr>
       `).join('');
                });
        }
        atualiza();

        function criarUsuario() {
            const formulario = document.getElementById("form-criacao");
            const data = new URLSearchParams(new FormData(formulario));
            fetch('/orcamentos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: data
            })
        }

        function editarUsuario() {
            const formulario = document.getElementById("form-edicao");
            const data = new URLSearchParams(new FormData(formulario));
            fetch('/orcamentos', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: data
            })
        }

        function deletarUsuario() {
            const rm = document.getElementById('dl-id_planta').value;
            fetch('/orcamentos/' + rm, {
                method: 'DELETE'
            })
        }
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <script>
        $(document).ready(function () {
            $("#myBtn").click(function () {
                $("#myModal").modal();
            });
        });
    </script>

</body>

</html>